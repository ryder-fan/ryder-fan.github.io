// @ts-nocheck
"use strict";console.warn=function(...e){console.log("[WARNING]",...e),Dialog.warning("警告",e.join(" "))},console.error=function(...e){console.log("[ERROR]",...e),Dialog.error("错误",e.join(" "))};class Dialog{static info(e,t){Swal.fire(e,t,"info")}static success(e,t){Swal.fire(e,t,"success")}static error(e,t){Swal.fire(e,t,"error")}static warning(e,t){Swal.fire(e,t,"warning")}static confirm(e,t,s){Swal.fire({title:e,text:t,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定",cancelButtonText:"取消"}).then((e=>{e.isConfirmed?s(!0):s(!1)}))}}class ImgManager{static#e={"CC-B":"img/CC-B.png","CC-C":"img/CC-C.png","CC-M":"img/CC-M.png","CC-P":"img/CC-P.png","CC-S":"img/CC-S.png","CC-W":"img/CC-W.png","CC-X":"img/CC-X.png","IC-B":"img/IC-B.png","IC-K":"img/IC-K.png","IC-N":"img/IC-N.png","IC-Q":"img/IC-Q.png","IC-R":"img/IC-R.png","IC-S":"img/IC-S.png",background:"img/background.png"};constructor(){}static getImg(e){return this.#e[e]?this.#e[e]:""}static async loadImgs(e){let t=Date.now();console.log("Start load imgs...");const s=document.querySelector("#loader-container"),o=document.querySelector("#loadingtext"),i=document.querySelector("#loadingimg");let C,n=0,a=Object.keys(this.#e).length;for(let e in this.#e)i.src=this.#e[e],i.onload=function(){n++,o.textContent="Loading ("+n+"/"+a+") ...",C()},i.onerror=function(){console.warn("error load img: "+e),n++,o.textContent="Loading ("+n+"/"+a+") ...",C()},await new Promise((e=>C=e));s.parentNode&&s.parentNode.removeChild(s),console.log("Load imgs done, time: "+(Date.now()-t)+"ms"),e&&e()}}class GameManager{static size;static#t;static#s;static#o;static player_color={CC:"红方",IC:"黑方"};static player_turn;static chessMap={"CC-B1":{x:2,y:7,type:"CC-B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-B2":{x:3,y:7,type:"CC-B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-B3":{x:4,y:7,type:"CC-B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-B4":{x:6,y:7,type:"CC-B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-B5":{x:7,y:7,type:"CC-B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-C1":{x:1,y:7,type:"CC-C",color:"CC",img:ImgManager.getImg("CC-C")},"CC-C2":{x:8,y:7,type:"CC-C",color:"CC",img:ImgManager.getImg("CC-C")},"CC-M1":{x:2,y:8,type:"CC-M",color:"CC",img:ImgManager.getImg("CC-M")},"CC-M2":{x:7,y:8,type:"CC-M",color:"CC",img:ImgManager.getImg("CC-M")},"CC-P1":{x:1,y:8,type:"CC-P",color:"CC",img:ImgManager.getImg("CC-P")},"CC-P2":{x:8,y:8,type:"CC-P",color:"CC",img:ImgManager.getImg("CC-P")},"CC-S1":{x:5,y:7,type:"CC-S",color:"CC",img:ImgManager.getImg("CC-S")},"CC-S2":{x:5,y:8,type:"CC-S",color:"CC",img:ImgManager.getImg("CC-S")},"CC-W":{x:4,y:8,type:"CC-W",color:"CC",img:ImgManager.getImg("CC-W")},"CC-X1":{x:3,y:8,type:"CC-X",color:"CC",img:ImgManager.getImg("CC-X")},"CC-X2":{x:6,y:8,type:"CC-X",color:"CC",img:ImgManager.getImg("CC-X")},"IC-B1":{x:3,y:1,type:"IC-B",color:"IC",img:ImgManager.getImg("IC-B")},"IC-B2":{x:6,y:1,type:"IC-B",color:"IC",img:ImgManager.getImg("IC-B")},"IC-K":{x:4,y:1,type:"IC-K",color:"IC",img:ImgManager.getImg("IC-K")},"IC-N1":{x:2,y:1,type:"IC-N",color:"IC",img:ImgManager.getImg("IC-N")},"IC-N2":{x:7,y:1,type:"IC-N",color:"IC",img:ImgManager.getImg("IC-N")},"IC-Q":{x:5,y:1,type:"IC-Q",color:"IC",img:ImgManager.getImg("IC-Q")},"IC-R1":{x:1,y:1,type:"IC-R",color:"IC",img:ImgManager.getImg("IC-R")},"IC-R2":{x:8,y:1,type:"IC-R",color:"IC",img:ImgManager.getImg("IC-R")},"IC-S1":{x:1,y:2,type:"IC-S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S2":{x:2,y:2,type:"IC-S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S3":{x:3,y:2,type:"IC-S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S4":{x:4,y:2,type:"IC-S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S5":{x:5,y:2,type:"IC-S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S6":{x:6,y:2,type:"IC-S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S7":{x:7,y:2,type:"IC-S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S8":{x:8,y:2,type:"IC-S",color:"IC",img:ImgManager.getImg("IC-S")}};static ChessManagers={"CC-B1":void 0,"CC-B2":void 0,"CC-B3":void 0,"CC-B4":void 0,"CC-B5":void 0,"CC-C1":void 0,"CC-C2":void 0,"CC-M1":void 0,"CC-M2":void 0,"CC-P1":void 0,"CC-P2":void 0,"CC-S1":void 0,"CC-S2":void 0,"CC-W":void 0,"CC-X1":void 0,"CC-X2":void 0,"IC-B1":void 0,"IC-B2":void 0,"IC-K":void 0,"IC-N1":void 0,"IC-N2":void 0,"IC-Q":void 0,"IC-R1":void 0,"IC-R2":void 0,"IC-S1":void 0,"IC-S2":void 0,"IC-S3":void 0,"IC-S4":void 0,"IC-S5":void 0,"IC-S6":void 0,"IC-S7":void 0,"IC-S8":void 0};static movingChess;static setup(){this.#t=document.getElementById("board"),this.#s=document.getElementById("board-img"),this.#o=document.getElementById("player-turn"),this.setupBoard(),this.setSize()}static setSize(){this.size=Math.min(window.innerWidth,window.innerHeight),window.innerWidth>=window.innerHeight?document.body.className="horizontal":document.body.className="vertical",this.#t.style.width=.8*this.size+"px",this.#t.style.height=.8*this.size+"px"}static setupBoard(){this.#t.addEventListener("click",this.boardClicked.bind(this)),this.#s.src=ImgManager.getImg("background");for(const e in this.chessMap)this.ChessManagers[e]=new ChessManager(e);this.player_turn="CC",this.#o.textContent=`${this.player_color[this.player_turn]}`}static unChooseAll(){for(const e in this.ChessManagers)"chosen"==this.ChessManagers[e].status&&this.ChessManagers[e].unChoose();this.movingChess=void 0}static getChessByPos(e,t){for(const s in this.chessMap){const o=this.ChessManagers[s];if(o.posx==e&&o.posy==t)return o}}static boardClicked(e){const t=Math.floor(e.offsetX/(.8*this.size/8))+1,s=Math.floor(e.offsetY/(.8*this.size/8))+1,o=this.getChessByPos(t,s);if(o)""==o.status?o.id.startsWith(this.player_turn)?(this.unChooseAll(),o.choose()):this.movingChess?this.movingChess.moveTo(t,s):Dialog.error("不是你的回合",`现在为${this.player_color[this.player_turn]}走棋`):"chosen"==o.status&&this.unChooseAll();else{if(!this.movingChess)return;this.movingChess.moveTo(t,s)}}static nextRound(){"CC"==this.player_turn?this.player_turn="IC":this.player_turn="CC",this.#o.textContent=`${this.player_color[this.player_turn]}`,Dialog.success("走棋成功",`现在为${this.player_color[this.player_turn]}走棋`)}}class ChessManager{chessMap=GameManager.chessMap;#i;#t;id;type;status="";posx;posy;constructor(e){this.#t=document.getElementById("board"),this.id=e,this.type=this.chessMap[e].type,this.createChess(e)}unChoose(){GameManager.movingChess==this&&(GameManager.movingChess=void 0),this.status="",this.#i.classList.remove("chosen")}choose(){GameManager.movingChess=this,this.status="chosen",this.#i.classList.add("chosen")}createChess(){this.#i=document.createElement("div"),this.#i.id=this.id,this.#i.classList.add("chess");const e=document.createElement("img");e.id=this.id+"-img",e.src=this.chessMap[this.id].img,e.alt=this.id,this.#i.appendChild(e),this.#t.appendChild(this.#i),this.setPos(this.chessMap[this.id].x,this.chessMap[this.id].y)}setPos(e,t){[1,2,3,4,5,6,7,8].includes(e)&&[1,2,3,4,5,6,7,8].includes(t)?(this.posx=e,this.posy=t,this.#i.style.left=12.5*(e-1)+"%",this.#i.style.top=12.5*(t-1)+"%"):-1==e&&-1==t?(this.posx=-1,this.posy=-1,this.#i.parentNode&&this.#i.parentNode.removeChild(this.#i)):console.warn(`Invalid position: (${e}, ${t}), Chess: ${this.id}`)}canMoveTo(e,t){if(![1,2,3,4,5,6,7,8].includes(e)||![1,2,3,4,5,6,7,8].includes(t))return!1;let s=MoveManager.canMovePosList(this);console.log(s);for(let o of s)if(o[0]==e&&o[1]==t)return!0;return!1}moveTo(e,t){if("chosen"!=this.status)return GameManager.unChooseAll();if([1,2,3,4,5,6,7,8].includes(e)&&[1,2,3,4,5,6,7,8].includes(t)){if(!this.canMoveTo(e,t))return Dialog.warning("移动失败",`${this.id}不能从(${this.posx}, ${this.posy})移动到(${e}, ${t})`);if(GameManager.getChessByPos(e,t)){const s=GameManager.getChessByPos(e,t);s.status="eaten",s.setPos(-1,-1)}this.setPos(e,t),GameManager.nextRound()}}}class MoveManager{static hasChess(e,t){return!!GameManager.getChessByPos(e,t)}static canEat(e,t,s){if(!this.hasChess(e,t))return!0;const o=GameManager.getChessByPos(e,t);return console.log(o.id.slice(0,2),s),o.id.slice(0,2)!=s}static canMovePosList(e){const t=e.posx,s=e.posy,o=e.id.slice(0,2);return"CC-B"===e.type?this.moveCCB(t,s,o):[]}static moveCCB(e,t,s){let o=[];return this.canEat(e,t-1,s)&&o.push([e,t-1]),t<=4&&this.canEat(e-1,t,s)&&o.push([e-1,t]),t<=4&&this.canEat(e+1,t,s)&&o.push([e+1,t]),o}}document.addEventListener("DOMContentLoaded",(()=>ImgManager.loadImgs(GameManager.setup.bind(GameManager)))),window.addEventListener("resize",GameManager.setSize.bind(GameManager));