// @ts-nocheck
"use strict";console.warn=function(...e){console.log("[WARNING]",...e),Dialog.warning("警告",e.join(" "))},console.error=function(...e){console.log("[ERROR]",...e),Dialog.error("错误",e.join(" "))};class Dialog{static info(e,t){Swal.fire(e,t,"info")}static success(e,t){Swal.fire(e,t,"success")}static error(e,t){Swal.fire(e,t,"error")}static warning(e,t){Swal.fire(e,t,"warning")}static confirm(e,t,o){Swal.fire({title:e,text:t,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"确定",cancelButtonText:"取消"}).then((e=>{e.isConfirmed?o(!0):o(!1)}))}}class ImgManager{static#e={"CC-B":"img/CC-B.png","CC-C":"img/CC-C.png","CC-M":"img/CC-M.png","CC-P":"img/CC-P.png","CC-S":"img/CC-S.png","CC-W":"img/CC-W.png","CC-X":"img/CC-X.png","IC-B":"img/IC-B.png","IC-K":"img/IC-K.png","IC-N":"img/IC-N.png","IC-Q":"img/IC-Q.png","IC-R":"img/IC-R.png","IC-S":"img/IC-S.png",background:"img/background.png"};constructor(){}static getImg(e){return this.#e[e]?this.#e[e]:""}static async loadImgs(e){let t=Date.now();console.log("Start load imgs...");const o=document.querySelector("#loader-container"),s=document.querySelector("#loadingtext"),i=document.querySelector("#loadingimg");let C,g=0,n=Object.keys(this.#e).length;for(let e in this.#e)i.src=this.#e[e],i.onload=function(){g++,s.textContent="Loading ("+g+"/"+n+") ...",C()},i.onerror=function(){console.warn("error load img: "+id),g++,s.textContent="Loading ("+g+"/"+n+") ...",C()},await new Promise((e=>C=e));o.parentNode&&o.parentNode.removeChild(o),console.log("Load imgs done, time: "+(Date.now()-t)+"ms"),e&&e()}}class GameManager{static size;static#t;static#o;static#s;static player_color={CC:"红方",IC:"黑方"};static player_turn;static chessMap={"CC-B1":{x:2,y:7,type:"B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-B2":{x:3,y:7,type:"B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-B3":{x:4,y:7,type:"B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-B4":{x:6,y:7,type:"B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-B5":{x:7,y:7,type:"B",color:"CC",img:ImgManager.getImg("CC-B")},"CC-C1":{x:1,y:7,type:"CC",color:"CC",img:ImgManager.getImg("CC-C")},"CC-C2":{x:8,y:7,type:"CC",color:"CC",img:ImgManager.getImg("CC-C")},"CC-M1":{x:2,y:8,type:"M",color:"CC",img:ImgManager.getImg("CC-M")},"CC-M2":{x:7,y:8,type:"M",color:"CC",img:ImgManager.getImg("CC-M")},"CC-P1":{x:1,y:8,type:"P",color:"CC",img:ImgManager.getImg("CC-P")},"CC-P2":{x:8,y:8,type:"P",color:"CC",img:ImgManager.getImg("CC-P")},"CC-S1":{x:5,y:7,type:"S",color:"CC",img:ImgManager.getImg("CC-S")},"CC-S2":{x:5,y:8,type:"S",color:"CC",img:ImgManager.getImg("CC-S")},"CC-W":{x:4,y:8,type:"W",color:"CC",img:ImgManager.getImg("CC-W")},"CC-X1":{x:3,y:8,type:"X",color:"CC",img:ImgManager.getImg("CC-X")},"CC-X2":{x:6,y:8,type:"X",color:"CC",img:ImgManager.getImg("CC-X")},"IC-B1":{x:3,y:1,type:"B",color:"IC",img:ImgManager.getImg("IC-B")},"IC-B2":{x:6,y:1,type:"B",color:"IC",img:ImgManager.getImg("IC-B")},"IC-K":{x:4,y:1,type:"K",color:"IC",img:ImgManager.getImg("IC-K")},"IC-N1":{x:2,y:1,type:"N",color:"IC",img:ImgManager.getImg("IC-N")},"IC-N2":{x:7,y:1,type:"N",color:"IC",img:ImgManager.getImg("IC-N")},"IC-Q":{x:5,y:1,type:"Q",color:"IC",img:ImgManager.getImg("IC-Q")},"IC-R1":{x:1,y:1,type:"R",color:"IC",img:ImgManager.getImg("IC-R")},"IC-R2":{x:8,y:1,type:"R",color:"IC",img:ImgManager.getImg("IC-R")},"IC-S1":{x:1,y:2,type:"S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S2":{x:2,y:2,type:"S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S3":{x:3,y:2,type:"S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S4":{x:4,y:2,type:"S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S5":{x:5,y:2,type:"S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S6":{x:6,y:2,type:"S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S7":{x:7,y:2,type:"S",color:"IC",img:ImgManager.getImg("IC-S")},"IC-S8":{x:8,y:2,type:"S",color:"IC",img:ImgManager.getImg("IC-S")}};static ChessManagers={"CC-B1":void 0,"CC-B2":void 0,"CC-B3":void 0,"CC-B4":void 0,"CC-B5":void 0,"CC-C1":void 0,"CC-C2":void 0,"CC-M1":void 0,"CC-M2":void 0,"CC-P1":void 0,"CC-P2":void 0,"CC-S1":void 0,"CC-S2":void 0,"CC-W":void 0,"CC-X1":void 0,"CC-X2":void 0,"IC-B1":void 0,"IC-B2":void 0,"IC-K":void 0,"IC-N1":void 0,"IC-N2":void 0,"IC-Q":void 0,"IC-R1":void 0,"IC-R2":void 0,"IC-S1":void 0,"IC-S2":void 0,"IC-S3":void 0,"IC-S4":void 0,"IC-S5":void 0,"IC-S6":void 0,"IC-S7":void 0,"IC-S8":void 0};static movingChess;static setup(){this.#t=document.getElementById("board"),this.#o=document.getElementById("board-img"),this.#s=document.getElementById("player-turn"),this.setupBoard(),this.setSize()}static setSize(){this.size=Math.min(window.innerWidth,window.innerHeight),window.innerWidth>=window.innerHeight?document.body.className="horizontal":document.body.className="vertical",this.#t.style.width=.8*this.size+"px",this.#t.style.height=.8*this.size+"px"}static setupBoard(){this.#t.addEventListener("click",this.boardClicked.bind(this)),this.#o.src=ImgManager.getImg("background");for(const e in this.chessMap)this.ChessManagers[e]=new ChessManager(e);this.player_turn="CC",this.#s.textContent=`${this.player_color[this.player_turn]}`}static unChooseAll(){for(const e in this.ChessManagers)"chosen"==this.ChessManagers[e].status&&this.ChessManagers[e].unChoose();this.movingChess=void 0}static getChessByPos(e,t){for(const o in this.chessMap){const s=this.ChessManagers[o];if(s.posx==e&&s.posy==t)return s}}static boardClicked(e){if(!this.movingChess)return;const t=Math.floor(e.offsetX/(.8*this.size/8)),o=Math.floor(e.offsetY/(.8*this.size/8));[1,2,3,4,5,6,7,8].includes(t)&&[1,2,3,4,5,6,7,8].includes(o)&&this.movingChess.moveTo(t,o)}}class ChessManager{chessMap=GameManager.chessMap;#i;#t;id;status="";posx;posy;constructor(e){this.#t=document.getElementById("board"),this.id=e,this.createChess(e)}unChoose(){GameManager.movingChess==this&&(GameManager.movingChess=void 0),this.status="",this.#i.classList.remove("chosen")}choose(){this.id.startsWith(GameManager.player_turn)?(GameManager.movingChess=this,this.status="chosen",this.#i.classList.add("chosen")):Dialog.error("不是你的回合",`现在为${GameManager.player_color[GameManager.player_turn]}走棋`)}createChess(){this.#i=document.createElement("div"),this.#i.id=this.id,this.#i.classList.add("chess"),this.#i.addEventListener("click",this.onClicked.bind(this));const e=document.createElement("img");e.id=this.id+"-img",e.src=this.chessMap[this.id].img,e.alt=this.id,this.#i.appendChild(e),this.#t.appendChild(this.#i),this.setPos(this.chessMap[this.id].x,this.chessMap[this.id].y)}setPos(e,t){[1,2,3,4,5,6,7,8].includes(e)&&[1,2,3,4,5,6,7,8].includes(t)?(this.posx=e,this.posy=t,this.#i.style.left=12.5*(e-1)+"%",this.#i.style.top=12.5*(t-1)+"%"):console.warn(`Invalid position: (${e}, ${t}), Chess: ${this.id}`)}onClicked(){""==this.status?(GameManager.unChooseAll(),this.choose()):"chosen"==this.status&&this.unChoose()}moveTo(e,t){if("chosen"!=this.status)return GameManager.unChooseAll();[1,2,3,4,5,6,7,8].includes(e)&&[1,2,3,4,5,6,7,8].includes(t)}}document.addEventListener("DOMContentLoaded",(()=>ImgManager.loadImgs(GameManager.setup.bind(GameManager)))),window.addEventListener("resize",GameManager.setSize.bind(GameManager));